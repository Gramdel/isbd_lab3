select count(distinct "Н_УЧЕНИКИ"."ЧЛВК_ИД")
from "Н_ЛЮДИ"
         join "Н_УЧЕНИКИ" on "Н_ЛЮДИ"."ИД" = "Н_УЧЕНИКИ"."ЧЛВК_ИД"
         join "Н_ПЛАНЫ" on "Н_УЧЕНИКИ"."ПЛАН_ИД" = "Н_ПЛАНЫ"."ИД"
         join "Н_ОТДЕЛЫ" on "Н_ПЛАНЫ"."ОТД_ИД" = "Н_ОТДЕЛЫ"."ИД"
where "Н_ОТДЕЛЫ"."КОРОТКОЕ_ИМЯ" = 'КТиУ'
  and "Н_УЧЕНИКИ"."ЧЛВК_ИД" not in (select "ЧЛВК_ИД" from "Н_ВЕДОМОСТИ" where "ОЦЕНКА" < '5' or "ОЦЕНКА" = 'незач')